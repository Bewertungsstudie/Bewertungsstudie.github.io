<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Umfrage-Verteiler</title>
  <script>
    const links = [
      ["https://survey.questionstar.com/cb99420f", "countera"],
      ["https://survey.questionstar.com/9f6bf697", "counterb"],
      ["https://survey.questionstar.com/172443bb", "counterc"],
      ["https://survey.questionstar.com/2daa4b2d", "counterd"],
      ["https://survey.questionstar.com/b0c109f6", "countere"],
      ["https://survey.questionstar.com/9e704022", "counterf"]
    ];

    const API_BASE = "https://api.counterapi.dev/v1/bewertungsstudie";

    // Pick a random index (since we can't fetch counts due to CORS)
    function getNextIndex() {
      return Math.floor(Math.random() * links.length);
    }

    // Increment counter by navigating to the API endpoint in a hidden iframe
    function incrementCounter(counterName) {
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = `${API_BASE}/${counterName}/up`;
      document.body.appendChild(iframe);

      // Remove iframe after a short delay to clean up
      setTimeout(() => document.body.removeChild(iframe), 1000);
    }

    // Main redirect function
    function redirectToSurvey() {
      const idx = getNextIndex();
      const [link, counterName] = links[idx];

      // Increment the chosen counter and total counter
      incrementCounter(counterName);
      incrementCounter("countertotal");

      // Redirect to the survey
      window.location.href = link;
    }

    window.onload = redirectToSurvey;
  </script>
</head>
<body>
  <p>Du wirst gleich weitergeleitet ...</p>
</body>
</html>
